<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>树状数组 &#8211; NetPipe&#39;s Blog</title>

  
  <meta name="description" content="问题 ¶数组 $A$ 中共 $n$ 个元素，对其反复进行以下操作共 $m$ 次：">
  
  <meta name="author" content="NetPipe">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="../../../../index.xml" rel="alternate" type="application/rss+xml" title="NetPipe&#39;s Blog" />
  <link rel="shortcut icon" type="image/x-icon" href="../../../../images/freeze.png" />

  
    <style>@font-face {
  font-family: 'Fantasque Sans Mono';
  src: url("/fonts/FantasqueSansMono-Regular.woff2") format("woff2"); }

@font-face {
  font-family: 'Fantasque Sans Mono';
  font-style: normal;
  font-weight: bold;
  src: url("/fonts/FantasqueSansMono-Bold.woff2") format("woff2"); }

@font-face {
  font-family: 'Fantasque Sans Mono';
  font-style: italic;
  src: url("/fonts/FantasqueSansMono-Italic.woff2") format("woff2"); }

@font-face {
  font-family: 'Lazy';
  src: url("/fonts/lazy.ttf") format("truetype"); }

@font-face {
  font-family: 'Material Icons';
  font-style: normal;
  font-weight: 400;
  src: url("/fonts/Material Icons.woff2") format("woff2"); }

/* fallback */
@font-face {
  font-family: 'Material Icons Outlined';
  font-style: normal;
  font-weight: 400;
  src: url("/fonts/Material Icons Outlined.woff2") format("woff2"); }

/* fallback */
@font-face {
  font-family: 'Material Icons Round';
  font-style: normal;
  font-weight: 400;
  src: url("/fonts/Material Icons Round.woff2") format("woff2"); }

/* fallback */
@font-face {
  font-family: 'Material Icons Sharp';
  font-style: normal;
  font-weight: 400;
  src: url("/fonts/Material Icons Sharp.woff2") format("woff2"); }

/* fallback */
@font-face {
  font-family: 'Material Icons Two Tone';
  font-style: normal;
  font-weight: 400;
  src: url("/fonts/Material Icons Two Tone.woff2") format("woff2"); }

.material-icons {
  font-family: 'Material Icons';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased; }

.material-icons-outlined {
  font-family: 'Material Icons Outlined';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased; }

.material-icons-round {
  font-family: 'Material Icons Round';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased; }

.material-icons-sharp {
  font-family: 'Material Icons Sharp';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased; }

.material-icons-two-tone {
  font-family: 'Material Icons Two Tone';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased; }

body,
code,
input {
  font-family: 'Fantasque Sans Mono', sans-serif;
  -webkit-font-smoothing: antialiased; }
  body article h1, body article h2, body article h3, body article h4, body article h5, body article h6, body .posts h1, body .posts h2, body .posts h3, body .posts h4, body .posts h5, body .posts h6,
  code article h1,
  code article h2,
  code article h3,
  code article h4,
  code article h5,
  code article h6,
  code .posts h1,
  code .posts h2,
  code .posts h3,
  code .posts h4,
  code .posts h5,
  code .posts h6,
  input article h1,
  input article h2,
  input article h3,
  input article h4,
  input article h5,
  input article h6,
  input .posts h1,
  input .posts h2,
  input .posts h3,
  input .posts h4,
  input .posts h5,
  input .posts h6 {
    font-weight: normal; }

strong {
  font-weight: normal;
  text-shadow: 0 0; }

* {
  margin: 0;
  padding: 0;
  user-select: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  --aside-width: 18rem;
  --box-shadow: 0 1px 6px 0 rgba(0, 0, 0, 0.1);
  --box-shadow-hover: 0 2px 16px 0 rgba(0, 0, 0, 0.1); }

* {
  --color: black;
  --border: 1px solid #dee0e2;
  --border-color: #dee0e2;
  --border-radius: 0.25rem;
  --link-color: #4588be;
  --category-color: rgba(173, 216, 230, .7);
  --background-color: white;
  --hover-color: #f7f7f7; }
  * body {
    background-color: #f6f6f6; }

::selection {
  background-color: #CCE2FF;
  color: rgba(0, 0, 0, 0.87); }

::-webkit-scrollbar {
  width: 7px;
  height: 7px; }

::-webkit-scrollbar-thumb {
  border-radius: 10px;
  background: #dddddd; }
  ::-webkit-scrollbar-thumb:hover {
    background: #acacac; }

::-webkit-scrollbar-track {
  border-radius: 10px;
  background: #f0f0f0; }

a {
  text-decoration: none;
  color: #4794d3; }

a:focus, a:hover {
  outline: none;
  text-decoration: underline; }

a.alternate:focus,
a.alternate:hover,
a.alternate:focus > *,
a.alternate:hover > * {
  text-decoration: none;
  background: var(--hover-color); }

small {
  font-size: 70%; }

ol, ul {
  margin: .5rem 0;
  padding-left: 2rem;
  word-break: break-word; }
  ol > li, ul > li {
    margin: .5rem 0; }

ul > li {
  list-style: circle; }

.result {
  width: 100%; }
  .result :first-child .post {
    margin-top: 0; }
  .result :last-child .post {
    margin-bottom: 0; }

.flex {
  display: flex; }

.flex-auto {
  flex: 1 1 auto; }

.flex-even {
  flex: 1 1; }

.flex-wrap {
  flex-wrap: wrap; }

.justify-start {
  justify-content: flex-start; }

.justify-end {
  justify-content: flex-end; }

.justify-center {
  justify-content: center; }

.justify-between {
  justify-content: space-between; }

.align-center {
  align-items: center; }

.mx-auto {
  margin: 0 auto; }

.text-center {
  text-align: center; }

.text-left {
  text-align: left; }

.text-right {
  text-align: right; }

.hidden {
  display: none; }

body {
  max-width: 80rem;
  margin: 0 auto;
  overflow: hidden scroll; }

main {
  display: flex; }

article {
  overflow: hidden;
  will-change: transform; }

div.avatar {
  text-align: center; }
  div.avatar .data-left,
  div.avatar .data-right {
    flex: 0 0 50%;
    display: inline-block;
    width: calc(50% - 1rem); }
  div.avatar .data-left {
    border-right: 1px solid var(--color); }
  div.avatar .social {
    margin-top: 1rem; }
    div.avatar .social .social-box {
      border: var(--border);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      background-color: var(--background-color);
      color: var(--color);
      margin-top: .5rem;
      padding: .5rem;
      text-align: left;
      font-size: 18px; }
      div.avatar .social .social-box:hover {
        box-shadow: var(--box-shadow-hover); }
      div.avatar .social .social-box a {
        color: var(--color); }
      div.avatar .social .social-box:hover a {
        color: var(--link-color);
        text-decoration: underline; }
      div.avatar .social .social-box img {
        vertical-align: text-bottom;
        width: 20px; }
      div.avatar .social .social-box .search {
        display: inline-block;
        width: calc(100% - 36px); }
        div.avatar .social .social-box .search > input {
          background-color: var(--background-color);
          color: var(--color);
          border: none;
          font-size: 17px;
          outline: none;
          width: 100%; }

div.categories .post-categories {
  font-size: 100%;
  margin: .5rem 0;
  line-height: 1.7rem; }

#TableOfContents > ul {
  padding-left: 0; }
  #TableOfContents > ul li {
    list-style: none; }

.flex-left,
.flex-right {
  flex: 0 0 var(--aside-width); }
  .flex-left div.outer,
  .flex-right div.outer {
    padding: .7rem;
    margin: .3rem;
    width: calc(var(--aside-width) - 2rem);
    height: calc(100% - 2rem);
    overflow: hidden;
    position: fixed; }
    .flex-left div.outer::-webkit-scrollbar-track,
    .flex-right div.outer::-webkit-scrollbar-track {
      margin: .7rem; }
    .flex-left div.outer:hover,
    .flex-right div.outer:hover {
      overflow: auto; }
  .flex-left div.inner,
  .flex-right div.inner {
    border: var(--border);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    background-color: var(--background-color);
    color: var(--color);
    box-sizing: border-box;
    width: calc(var(--aside-width) - 2rem);
    padding: .5rem;
    margin-bottom: 1rem;
    overflow: auto;
    padding: 1rem; }
    .flex-left div.inner:hover,
    .flex-right div.inner:hover {
      box-shadow: var(--box-shadow-hover); }
    .flex-left div.inner h2,
    .flex-right div.inner h2 {
      margin: .5rem 0;
      line-height: 20px; }
      .flex-left div.inner h2 > img,
      .flex-right div.inner h2 > img {
        vertical-align: -2px;
        width: 20px;
        height: 20px;
        margin-right: .5rem; }
    .flex-left div.inner ul,
    .flex-right div.inner ul {
      padding-left: 1rem; }
    .flex-left div.inner > :first-child,
    .flex-right div.inner > :first-child {
      margin-top: 0; }
    .flex-left div.inner > :last-child,
    .flex-right div.inner > :last-child {
      margin-bottom: 0; }
    .flex-left div.inner:last-of-type,
    .flex-right div.inner:last-of-type {
      margin-bottom: 0; }

.flex-left {
  margin-right: -1rem; }
  .flex-left div.outer > div.inner:nth-last-child(2) {
    margin-bottom: 0; }

.flex-right {
  margin-left: -1rem; }

.flex-hidden {
  display: none; }

.blog-page {
  flex-grow: 1;
  min-width: 18rem;
  padding: 1rem;
  width: calc(100% - 42rem); }
  .blog-page .post-toc {
    display: none; }
  .blog-page .post-pagination {
    width: 100%;
    height: 2rem; }
  .blog-page .post-content {
    border: var(--border);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    background-color: var(--background-color);
    color: var(--color); }
    .blog-page .post-content:hover {
      box-shadow: var(--box-shadow-hover); }

.pagination {
  margin: 0;
  padding: 0;
  width: 100%;
  display: flex;
  flex-flow: row nowrap;
  align-items: center;
  justify-content: center;
  font-size: 18px; }
  .pagination div.pagination-box {
    border: var(--border);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    margin: 0 .5rem;
    color: var(--link-color);
    background-color: var(--background-color);
    width: 2rem;
    height: 2rem;
    line-height: 2rem;
    float: left;
    text-align: center;
    vertical-align: middle;
    cursor: default; }
    .pagination div.pagination-box:hover {
      box-shadow: var(--box-shadow-hover); }
    .pagination div.pagination-box:not(.disabled):hover {
      background-color: var(--hover-color);
      cursor: pointer; }
  .pagination div.prev {
    width: 5rem;
    margin-left: 0; }
  .pagination div.next {
    width: 5rem;
    margin-right: 0; }
  .pagination div.pagination-eldivpsis {
    width: 3rem; }
  .pagination div.disabled {
    color: var(--color); }

.posts .post {
  border: var(--border);
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  background-color: var(--background-color);
  color: var(--color);
  margin: 1rem 0;
  padding: .7rem 1rem; }
  .posts .post:hover {
    box-shadow: var(--box-shadow-hover); }

.posts :first-child .post {
  margin-top: 0; }

.post-list {
  border: var(--border);
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow); }
  .post-list:hover {
    box-shadow: var(--box-shadow-hover); }
  .post-list .post-item {
    padding: .3rem .5rem;
    height: 1.5rem; }
    .post-list .post-item * {
      font-size: 100%;
      vertical-align: bottom; }
    .post-list .post-item:hover a {
      color: var(--link-color);
      text-decoration: underline; }

.post-link {
  color: var(--color); }
  .post-link:hover .post-title a {
    color: var(--link-color);
    text-decoration: underline; }

.post-title {
  margin: 0 0 .5rem 0;
  font-size: 20px; }
  .post-title a {
    color: var(--color); }
  .post-title:hover a {
    color: var(--link-color);
    text-decoration: underline; }

.post-meta {
  color: gray; }
  .post-meta img {
    vertical-align: text-bottom; }

.post-categories {
  font-size: 85%; }
  .post-categories a {
    background-color: var(--category-color);
    border-radius: .2rem;
    padding: .1rem .2rem; }

.post-summary {
  margin-top: .5rem; }

.post-header {
  margin-bottom: 1rem; }

.post-content {
  text-align: justify;
  background-color: white;
  padding: 1rem; }
  .post-content .md__image {
    display: block;
    max-width: 100%;
    margin: auto; }

.post-content > :first-child,
.post-content > :first-child > :first-child,
.post-content > :first-child > :first-child > :first-child,
.markdown-inner > :first-child,
.markdown-inner > :first-child > :first-child,
.markdown-inner > :first-child > :first-child > :first-child {
  margin-top: 0; }

.post-content > :last-child,
.post-content > :last-child > :last-child,
.post-content > :last-child > :last-child > :last-child,
.markdown-inner > :last-child,
.markdown-inner > :last-child > :last-child,
.markdown-inner > :last-child > :last-child > :last-child {
  margin-bottom: 0rem; }

.scroll-to-top {
  border: var(--border);
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  display: none;
  position: fixed;
  bottom: 4rem;
  right: 2rem;
  width: 2.5rem;
  height: 2.5rem;
  background-color: white; }
  .scroll-to-top:hover {
    box-shadow: var(--box-shadow-hover); }
  .scroll-to-top img {
    width: 2rem;
    height: 2rem;
    margin: .25rem; }
  .scroll-to-top:hover {
    background-color: #eeeeee; }

@media screen and (max-width: 70rem) {
  .flex-left div.outer > div.inner:nth-last-child(2) {
    margin-bottom: 1rem; }
  .flex-left .flex-hidden {
    display: block; }
  .flex-right {
    display: none; } }

@media screen and (max-width: 48rem) {
  main {
    display: block; }
  .flex-left,
  .flex-right {
    width: 100%;
    margin: 0;
    margin-bottom: -1rem; }
    .flex-left div.outer,
    .flex-right div.outer {
      position: relative;
      width: auto; }
    .flex-left div.inner,
    .flex-right div.inner {
      width: auto; }
  .blog-page {
    width: calc(100% - 2rem); } }

.book-columns {
  margin: .5rem;
  margin-left: -.5rem;
  margin-right: -.5rem; }
  .book-columns div {
    margin: .5rem; }

.book-tabs {
  margin: .5em 0;
  overflow: hidden;
  display: flex;
  flex-wrap: wrap; }
  .book-tabs label {
    display: inline-block;
    padding: .3rem 16px;
    border-top-left-radius: var(--border-radius);
    border-top-right-radius: var(--border-radius);
    cursor: pointer;
    z-index: 999;
    border: 1px solid transparent; }
  .book-tabs .book-tabs-content,
  .book-tabs .book-tabs-pure-content {
    order: 999;
    width: 100%;
    display: none;
    overflow: hidden;
    border-bottom-left-radius: var(--border-radius);
    border-bottom-right-radius: var(--border-radius); }
  .book-tabs .book-tabs-content {
    border: var(--border);
    padding: .5rem; }
  .book-tabs input[type="radio"] {
    display: none; }
    .book-tabs input[type="radio"]:not(:checked) + label {
      color: #95A5A6; }
    .book-tabs input[type="radio"]:checked + label {
      border: var(--border);
      border-bottom: none; }
      .book-tabs input[type="radio"]:checked + label + .book-tabs-content, .book-tabs input[type="radio"]:checked + label + .book-tabs-pure-content {
        display: block; }
    .book-tabs input[type="radio"]:first-of-type:checked + label + .book-tabs-pure-content :first-child {
      border-top-left-radius: 0; }

details {
  border: var(--border);
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  margin: .5rem 0;
  padding: .5rem  1rem .5rem  0.75rem; }
  details:hover {
    box-shadow: var(--box-shadow-hover); }
  details summary {
    font-size: 12.8px;
    font-weight: bold; }
    details summary::marker {
      content: '';
      font-size: 0; }
  details ::-webkit-details-marker {
    content: '';
    font-size: 0; }
  details ::-moz-list-bullet {
    content: '';
    font-size: 0; }
  details label {
    font-size: 20px !important;
    margin-left: -5px;
    margin-right: 5px;
    vertical-align: -4.5px; }
  details[open] > summary {
    margin-bottom: 0; }
    details[open] > summary label {
      transform: rotate(90deg); }
  details .markdown-inner {
    margin-top: 1em;
    padding: .5rem 0; }
  details:focus {
    outline: none; }

article h1 {
  font-size: 200%;
  line-height: 110%; }

article h2 {
  font-size: 140%;
  line-height: 120%; }

article h3 {
  font-size: 120%;
  line-height: 120%; }
  article h3 .katex {
    font-size: 100%; }

article h4 {
  font-size: 110%; }

article p {
  line-height: 1.5rem; }

article h1, article h2, article h3, article h4, article h5, article h6, article p {
  margin: .5rem 0; }
  article h1 .anchor, article h2 .anchor, article h3 .anchor, article h4 .anchor, article h5 .anchor, article h6 .anchor, article p .anchor {
    opacity: 0; }
  article h1:hover .anchor, article h1:focus .anchor, article h2:hover .anchor, article h2:focus .anchor, article h3:hover .anchor, article h3:focus .anchor, article h4:hover .anchor, article h4:focus .anchor, article h5:hover .anchor, article h5:focus .anchor, article h6:hover .anchor, article h6:focus .anchor, article p:hover .anchor, article p:focus .anchor {
    opacity: 1; }

article hr {
  border: none;
  border-bottom: 1px solid #ebeced; }

article blockquote {
  border: var(--border);
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  border-left: .3rem solid lightgray;
  padding: 0 .5rem; }
  article blockquote:hover {
    box-shadow: var(--box-shadow-hover); }

article pre {
  border: var(--border);
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  margin: .5rem 0;
  padding: .5rem 1rem;
  overflow-x: auto;
  line-height: 22px; }
  article pre:hover {
    box-shadow: var(--box-shadow-hover); }

article code {
  border: var(--border);
  border-radius: var(--border-radius);
  padding: 1px 2px; }

article pre {
  color: #686868; }
  article pre code {
    border: none;
    padding: 0; }
  article pre * {
    user-select: text;
    -moz-user-select: text;
    -webkit-user-select: text; }

article code:focus {
  outline: none; }

article .md__table {
  margin: -.5rem;
  padding: .5rem;
  overflow: auto; }
  article .md__table::-webkit-scrollbar-track {
    margin: .5rem; }
  article .md__table table {
    border: var(--border);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    border-spacing: 0;
    overflow: auto;
    -webkit-overflow-scrolling: touch; }
    article .md__table table:hover {
      box-shadow: var(--box-shadow-hover); }
    article .md__table table th {
      font-weight: normal; }
    article .md__table table td {
      border-top: 1px solid var(--border-color); }
    article .md__table table th, article .md__table table td {
      padding: .3rem 16px;
      white-space: nowrap; }

article .mermaid svg {
  display: block;
  margin: auto;
  zoom: 80%; }
</style>
  
</head>






<body>
<main>
  <div class="flex-left">
    <div class="outer">
      
  <div class="inner avatar">
  <img src="../../../../images/freeze.png" class="avatar" width="96px" height="96px" />
  <h2>NetPipe</h2>
  <div class="data-left">
    <h3>57</h3>
    <span>Posts</span>
  </div>
  <div class="data-right">
    
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
    <h3>17895</h3>
    <span>Words</span>
  </div>
  <div class="social">
    <div class="social-box">
      <img src="../../../../images/search.svg"/>
      <div class="search">
        <input type="text" placeholder="Search" id="search-key" maxlength="64" data-hotkeys="s/" onkeydown="keyup_submit(event);" />
      </div>
    </div>
    <a class="alternate" href="../../../../">
      <div class="social-box">
        <img src="../../../../images/home.svg"/>
        <object><a href="../../../../">Home</a></object>
      </div>
    </a>
    <a class="alternate" href="../../../../post/">
      <div class="social-box">
        <img src="../../../../images/posts.svg"/>
        <object><a href="../../../../post/">Posts</a></object>
      </div>
    </a>
    <a class="alternate" type="application/rss+xml" href="../../../../index.xml">
      <div class="social-box">
        <img src="../../../../images/rss.svg"/>
        <object><a  type="application/rss+xml" href="../../../../index.xml">RSS</a></object>
      </div>
    </a>
  </div>
  <script>
    function keyup_submit(e){ 
    var evt = window.event || e; 
      if (evt.keyCode == 13){
        window.location.href = '/_search?wd=' + document.getElementById("search-key").value;
      }
    }
  </script>
</div>
  <div class="inner categories">
  <h2><img src="../../../../images/categories.svg" />Categories</h2>
  
  <span class="post-categories">
    <a href="../../../../categories/math/">Math</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../../categories/acm/">ACM</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../../categories/dp/">DP</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../../categories/number-theory/">Number Theory</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../../categories/graph-theory/">Graph Theory</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../../categories/data-structure/">Data Structure</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../../categories/string/">String</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../../categories/basic-algorithm/">Basic Algorithm</a>
  </span>
  
</div>

      <div class="flex-hidden">
        
  <div class="inner">
  <h2><img src="../../../../images/notice.svg" />Notice</h2>
  <p>Under Construction ...</p>
</div>
  

<div class="inner">
  <h2><img src="../../../../images/toc.svg">TOC</h2>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#问题">问题</a></li>
    <li><a href="#构造">构造</a>
      <ul>
        <li><a href="#父节点">父节点</a></li>
        <li><a href="#左邻节点">左邻节点</a></li>
      </ul>
    </li>
    <li><a href="#单点修改">单点修改</a></li>
    <li><a href="#区间查询">区间查询</a></li>
    <li><a href="#模板">模板</a></li>
    <li><a href="#拓展">拓展</a>
      <ul>
        <li><a href="#区间修改">区间修改</a></li>
      </ul>
    </li>
  </ul>
</nav>
</div>



      </div>
    </div>
  </div>

  
<div class="blog-page">
  <article class="post-content">
    
    <div class="post-header">
      <h1>树状数组</h1>
      <span class="post-meta">
        
          <img src="../../../../images/time.svg"></img>
          Apr 5, 2021
        
      </span>
      <span class="post-categories">
        
          <a href="../../../../categories/acm/">ACM</a>
        
          <a href="../../../../categories/data-structure/">Data Structure</a>
        
      </span>
    </div>
    
    <h2 id="问题">问题 <a class="anchor" href="#%e9%97%ae%e9%a2%98">¶</a></h2><p>数组 $A$ 中共 $n$ 个元素，对其反复进行以下操作共 $m$ 次：</p>
<ul>
<li>
<p><strong>单点修改</strong>：将 $A[ x]$ 加上 $k$.</p>
</li>
<li>
<p><strong>区间查询</strong>：查询 $A[l\cdots r]$ 的和.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">int</span> <span style="color:#434f54">a</span>[];

<span style="color:#00979d">void</span> <span style="color:#d35400">set</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">id</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">v</span>) { <span style="color:#95a5a6">// 单点修改
</span><span style="color:#95a5a6"></span>    <span style="color:#434f54">a</span>[<span style="color:#434f54">id</span>] <span style="color:#728e00">=</span> <span style="color:#434f54">v</span>;
}

<span style="color:#00979d">int</span> <span style="color:#d35400">ask</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">l</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">r</span>) { <span style="color:#95a5a6">// 区间查询
</span><span style="color:#95a5a6"></span>    <span style="color:#00979d">int</span> <span style="color:#434f54">ans</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
    <span style="color:#728e00">for</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">i</span> <span style="color:#728e00">=</span> <span style="color:#434f54">l</span>; <span style="color:#434f54">i</span> <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">r</span>; <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>)
        <span style="color:#434f54">ans</span> <span style="color:#728e00">+=</span> <span style="color:#434f54">a</span>[<span style="color:#434f54">i</span>];
    <span style="color:#728e00">return</span> <span style="color:#434f54">ans</span>;
}
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">暴力算法（$\textcolor{red}{×}$）</th>
<th style="text-align:center">树状数组（$\textcolor{green}{√}$）</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">单点修改</td>
<td style="text-align:center">$\textcolor{green}{O(1)}$</td>
<td style="text-align:center">$\textcolor{green}{O(\log{n})}$</td>
</tr>
<tr>
<td style="text-align:center">区间查询</td>
<td style="text-align:center">$\textcolor{red}{O(n)}$</td>
<td style="text-align:center">$\textcolor{green}{O(\log{n})}$</td>
</tr>
<tr>
<td style="text-align:center">$m$ 次操作</td>
<td style="text-align:center">$\textcolor{red}{O(mn)}$</td>
<td style="text-align:center">$\textcolor{green}{O(m\log{n})}$</td>
</tr>
</tbody>
</table>
<h2 id="构造">构造 <a class="anchor" href="#%e6%9e%84%e9%80%a0">¶</a></h2><p>在原数组的上方构建树型结构，每个节点表示一段区间和：</p>
<p><img class="md__image" src="1.png" alt=""  /></p>
<p>$C_1=A_1$；</p>
<p>$C_2=A_1+A_2$；</p>
<p>$C_3=A_3$；</p>
<p>$C_4=A_1+A_2+A_3+A_4$；</p>
<p>$\cdots \ \cdots$</p>
<h3 id="父节点">父节点 <a class="anchor" href="#%e7%88%b6%e8%8a%82%e7%82%b9">¶</a></h3><p>如何求 $C_i$ 的父节点？</p>
<p>将 $C$ 数组的下标转换成二进制数，观察该图.</p>
<p><img class="md__image" src="2.png" alt=""  /></p>
<ul>
<li>
<p>$C[$000<font color="red">1</font>$]$ 的父节点为 $C[$00<font color="red">10</font>$]$.</p>
</li>
<li>
<p>$C[$0<font color="red">100</font>$]$ 的父节点为 $C[$<font color="red">1000</font>$]$.</p>
</li>
<li>
<p>$C[$010<font color="red">1</font>$]$ 的父节点为 $C[$01<font color="red">10</font>$]$.</p>
<p>$\cdots \ \cdots$</p>
</li>
</ul>
<p>不难总结出规律：</p>
<ul>
<li>$C_i$ 的父节点为 $C[i+$ <a href="../../../../docs/NOI/Basics/zip/#lowbit-%E8%BF%90%E7%AE%97">$lowbit(i)$</a> $]$.</li>
</ul>
<h3 id="左邻节点">左邻节点 <a class="anchor" href="#%e5%b7%a6%e9%82%bb%e8%8a%82%e7%82%b9">¶</a></h3><p>$C_i$ 的「左邻节点」与 $C_i$ 的左端相邻.例如 $C_5$ 的左邻节点为 $C_4$.</p>
<p><img class="md__image" src="3.png" alt=""  /></p>
<p>观察同一张图：</p>
<p><img class="md__image" src="2.png" alt=""  /></p>
<ul>
<li>
<p>$C[$001<font color="red">1</font>$]$ 的左邻节点为 $C[$001<font color="red">0</font>$]$.</p>
</li>
<li>
<p>$C[$010<font color="red">1</font>$]$ 的左邻节点为 $C[$010<font color="red">0</font>$]$.</p>
</li>
<li>
<p>$C[$01<font color="red">10</font>$]$ 的左邻节点为 $C[$01<font color="red">00</font>$]$.</p>
</li>
</ul>
<p>总结规律：</p>
<ul>
<li>$C_i$ 的左邻节点为 $C[i-lowbit(i)]$.</li>
</ul>
<h2 id="单点修改">单点修改 <a class="anchor" href="#%e5%8d%95%e7%82%b9%e4%bf%ae%e6%94%b9">¶</a></h2><p>将 $A[x]$ 增加 $k$，$A[x]$ 的所有祖先都会跟着变动.以 $A_3$ 为例：</p>
<p><img class="md__image" src="4.png" alt=""  /></p>
<p>$C_3=\textcolor{red}{A_3}$；</p>
<p>$C_4=A_1+A_2+\textcolor{red}{A_3}+A_4$；</p>
<p>$C_8=A_1+A_2+\textcolor{red}{A_3}+A_4+A_5+A_6+A_7+A_8$.</p>
<p>因此，修改 $A[3]$ 的同时，$C_3,C_4,C_8$ 也需要加上 $k$.</p>
<p>对于给定的 $x$，从 $C_x$ 开始逐层访问 <a href="../../../../docs/NOI/DS/treearray/#%E7%88%B6%E8%8A%82%E7%82%B9">父节点</a>，并给其值加上 $k$.时间复杂度为 $O(\log{n})$.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">int</span> <span style="color:#d35400">lowbit</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">x</span>) {
    <span style="color:#728e00">return</span> <span style="color:#434f54">x</span> <span style="color:#728e00">&amp;</span> <span style="color:#728e00">-</span><span style="color:#434f54">x</span>;
}

<span style="color:#00979d">void</span> <span style="color:#d35400">add</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">p</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">k</span>) { <span style="color:#95a5a6">// 将 a[p] 增加 k
</span><span style="color:#95a5a6"></span>    <span style="color:#728e00">for</span>(; <span style="color:#434f54">p</span> <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">n</span>; <span style="color:#434f54">p</span> <span style="color:#728e00">+=</span> <span style="color:#434f54">lowbit</span>(<span style="color:#434f54">p</span>)) <span style="color:#434f54">c</span>[<span style="color:#434f54">p</span>] <span style="color:#728e00">+=</span> <span style="color:#434f54">k</span>;
}
</code></pre></div><h2 id="区间查询">区间查询 <a class="anchor" href="#%e5%8c%ba%e9%97%b4%e6%9f%a5%e8%af%a2">¶</a></h2><p>采用 <a href="../../../../docs/NOI/DP/basics/#%E5%89%8D%E7%BC%80%E5%92%8C">前缀和</a> 思想.$sum[x]$ 表示 $A[1]+A[2]+\cdots+A[x]$，则：</p>
<center>$A[l\cdots r]$ 的和 $=sum[r]-sum[l-1]$</center>
<p>自此，问题转换为求 $sum[x]$.以 $sum[7]$ 为例：</p>
<p><img class="md__image" src="5.png" alt=""  /></p>
<p>$C_4=A_1+A_2+A_3+A_4$；</p>
<p>$C_6=A_5+A_6$；</p>
<p>$C_7=A_7$；</p>
<p>因而 $sum[7]=C_4+C_6+C_7$.</p>
<p>查询 $sum[x]$ 时，从 $C_x$ 开始依次遍历 <a href="../../../../docs/NOI/DS/treearray/#%E5%B7%A6%E9%82%BB%E8%8A%82%E7%82%B9">左邻节点</a>.时间复杂度为 $O(\log{n})$.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">int</span> <span style="color:#d35400">ask</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">p</span>) { <span style="color:#95a5a6">// 查询 A[1...p] 的和
</span><span style="color:#95a5a6"></span>    <span style="color:#00979d">int</span> <span style="color:#434f54">sum</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
    <span style="color:#728e00">for</span>(; <span style="color:#434f54">p</span>; <span style="color:#434f54">p</span> <span style="color:#728e00">-=</span> <span style="color:#434f54">lowbit</span>(<span style="color:#434f54">p</span>)) <span style="color:#434f54">sum</span> <span style="color:#728e00">+=</span> <span style="color:#434f54">c</span>[<span style="color:#434f54">p</span>];
    <span style="color:#728e00">return</span> <span style="color:#434f54">sum</span>;
}

<span style="color:#00979d">int</span> <span style="color:#d35400">get</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">l</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">r</span>) { <span style="color:#95a5a6">// 查询 A[l...r] 的和
</span><span style="color:#95a5a6"></span>    <span style="color:#728e00">return</span> <span style="color:#434f54">ask</span>(<span style="color:#434f54">r</span>) <span style="color:#728e00">-</span> <span style="color:#434f54">ask</span>(<span style="color:#434f54">l</span> <span style="color:#728e00">-</span> <span style="color:#8a7b52">1</span>);
}
</code></pre></div><h2 id="模板">模板 <a class="anchor" href="#%e6%a8%a1%e6%9d%bf">¶</a></h2><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">int</span> <span style="color:#d35400">lowbit</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">x</span>) {
    <span style="color:#728e00">return</span> <span style="color:#434f54">x</span> <span style="color:#728e00">&amp;</span> <span style="color:#728e00">-</span><span style="color:#434f54">x</span>;
}

<span style="color:#00979d">void</span> <span style="color:#d35400">add</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">p</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">k</span>) {
    <span style="color:#728e00">for</span>(; <span style="color:#434f54">p</span> <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">n</span>; <span style="color:#434f54">p</span> <span style="color:#728e00">+=</span> <span style="color:#434f54">lowbit</span>(<span style="color:#434f54">p</span>)) <span style="color:#434f54">c</span>[<span style="color:#434f54">p</span>] <span style="color:#728e00">+=</span> <span style="color:#434f54">k</span>;
}

<span style="color:#00979d">int</span> <span style="color:#d35400">ask</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">p</span>) {
    <span style="color:#00979d">int</span> <span style="color:#434f54">sum</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
    <span style="color:#728e00">for</span>(; <span style="color:#434f54">p</span>; <span style="color:#434f54">p</span> <span style="color:#728e00">-=</span> <span style="color:#434f54">lowbit</span>(<span style="color:#434f54">p</span>)) <span style="color:#434f54">sum</span> <span style="color:#728e00">+=</span> <span style="color:#434f54">c</span>[<span style="color:#434f54">p</span>];
    <span style="color:#728e00">return</span> <span style="color:#434f54">sum</span>;
}

<span style="color:#00979d">int</span> <span style="color:#d35400">get</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">l</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">r</span>) {
    <span style="color:#728e00">return</span> <span style="color:#434f54">ask</span>(<span style="color:#434f54">r</span>) <span style="color:#728e00">-</span> <span style="color:#434f54">ask</span>(<span style="color:#434f54">l</span> <span style="color:#728e00">-</span> <span style="color:#8a7b52">1</span>);
}
</code></pre></div><h2 id="拓展">拓展 <a class="anchor" href="#%e6%8b%93%e5%b1%95">¶</a></h2><h3 id="区间修改">区间修改 <a class="anchor" href="#%e5%8c%ba%e9%97%b4%e4%bf%ae%e6%94%b9">¶</a></h3><p>如果你已经学过 <a href="../../../../docs/NOI/DP/basics/#%E5%B7%AE%E5%88%86">差分</a>，区间修改就容易的多.</p>
<ol>
<li>
<p>在数组 $A$ 的「差分数组」上建立树状数组.</p>
</li>
<li>
<p>将 $A[l\cdots r]$ 所有元素都加上 $v$ 时，$f[l]$ 增加了 $v$，$f[r+1]$ 减少了 $v$.</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">void</span> <span style="color:#d35400">seg_add</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">l</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">r</span>, <span style="color:#00979d">int</span> <span style="color:#434f54">v</span>) { <span style="color:#95a5a6">// 将 A[l...r] 加上 v
</span><span style="color:#95a5a6"></span>    <span style="color:#434f54">add</span>(<span style="color:#434f54">l</span>, <span style="color:#434f54">v</span>);
    <span style="color:#434f54">add</span>(<span style="color:#434f54">r</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#728e00">-</span><span style="color:#434f54">v</span>);
}

<span style="color:#00979d">int</span> <span style="color:#d35400">main</span>() {
    <span style="color:#95a5a6">/* 输入部分省略 */</span>
    <span style="color:#728e00">for</span>(<span style="color:#00979d">int</span> <span style="color:#434f54">i</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">1</span>; <span style="color:#434f54">i</span> <span style="color:#728e00">&lt;=</span> <span style="color:#434f54">n</span>; <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>) {
        <span style="color:#434f54">add</span>(<span style="color:#434f54">i</span>, <span style="color:#434f54">a</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">-</span> <span style="color:#434f54">a</span>[<span style="color:#434f54">i</span> <span style="color:#728e00">-</span> <span style="color:#8a7b52">1</span>]);
    }
}
</code></pre></div>
  </article>
  <div class="scroll-to-top">
    <img src="../../../../images/scroll-to-top.svg">
  </div>
</div>



  <div class="flex-right">
    <div class="outer">
      
  <div class="inner">
  <h2><img src="../../../../images/notice.svg" />Notice</h2>
  <p>Under Construction ...</p>
</div>
  

<div class="inner">
  <h2><img src="../../../../images/toc.svg">TOC</h2>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#问题">问题</a></li>
    <li><a href="#构造">构造</a>
      <ul>
        <li><a href="#父节点">父节点</a></li>
        <li><a href="#左邻节点">左邻节点</a></li>
      </ul>
    </li>
    <li><a href="#单点修改">单点修改</a></li>
    <li><a href="#区间查询">区间查询</a></li>
    <li><a href="#模板">模板</a></li>
    <li><a href="#拓展">拓展</a>
      <ul>
        <li><a href="#区间修改">区间修改</a></li>
      </ul>
    </li>
  </ul>
</nav>
</div>



    </div>
  </div>

  <script src="../../../../js/jquery.min.js"></script>


<script defer>















































</script>



<script>
function judgeScroll() {
  var scrollTop = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop;
  var scrollToTop = document.getElementsByClassName("scroll-to-top")[0];
  if (scrollTop <= 50) {
    scrollToTop.style.display = 'none';
  } else {
    scrollToTop.style.display = 'block';
  }
}
window.addEventListener("scroll", function(event) {
  judgeScroll();
});
$(".scroll-to-top").click(function() {
  $(window).scrollTop(true);
});
judgeScroll();
</script>





<link rel="stylesheet" href="../../../../katex/katex.min.css">
<script src="../../../../katex/katex.min.js"></script>
<script src="../../../../katex/auto-render.min.js"></script>

<script>
  function renderTex() {
    renderMathInElement(document.body, {
      trust: true,
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false }
      ],
      macros: {
        
        "\\d": "\\text{d}",
        "\\zh": "\\footnotesize \\ ",
        "\\en": "\\normalsize \\ ",
        "\\su": "\\displaystyle",
        "\\eq": "\\Longleftrightarrow",
        "\\intro": "\\Longrightarrow",
        "\\mathring": "\\overset\{\\normalsizeₒ\}",
        "\\arccot": "\\text\{arccot\} \\, ",
        "\\xor": "\\text\{xor\} \\, ",
        "\\mex": "\\text\{mex\} \\, "
      }
    });
  }  
  document.addEventListener("DOMContentLoaded", function() {
    renderTex();
  });

</script>

<script>
    Array.from(document.getElementsByClassName("language-latex")).forEach(
      (el) => {
        
        el.parentElement.outerHTML = `<div>$$${el.innerText}$$</div>`;
      }
    );
</script>

<script>
  Array.from(document.getElementsByTagName("table")).forEach(
    (el) => {
      el.outerHTML = `<div class="md__table">${el.outerHTML}</div>`;
    }
  );
</script>



<script src="../../../../js/mermaid.min.js"></script>

<script>
  mermaid.initialize({
    
    themeCSS: ".node rect { \
      fill: transparent;    \
      stroke: transparent;  \
    }                       \
    .nodeLabel {            \
      font-size: 24px;      \
    }",
    startOnLoad: true,
    flowchart: {
      curve: 'cardinal'
    },
    securityLevel: 'loose',
  });
</script>

<script>
  Array.from(document.getElementsByClassName("language-mermaid")).forEach(
    (el) => {
      el.parentElement.outerHTML = `<div class="mermaid">${el.innerText}</div>`;
    }
  );
</script>

  
</main>
</body>
</html>