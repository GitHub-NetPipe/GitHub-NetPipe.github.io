<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>KMP 算法 &#8211; NetPipe&#39;s Blog</title>

  
  <meta name="description" content="简介 ¶KMP 算法并不能用来看毛片，它是一种字符串匹配算法.">
  
  <meta name="author" content="NetPipe">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="../../../../index.xml" rel="alternate" type="application/rss+xml" title="NetPipe&#39;s Blog" />
  <link rel="shortcut icon" type="image/x-icon" href="../../../../images/freeze.png" />

  
    <style>@font-face {
  font-family: 'Fantasque Sans Mono';
  src: url("/fonts/FantasqueSansMono-Regular.woff2") format("woff2"); }

@font-face {
  font-family: 'Fantasque Sans Mono';
  font-style: normal;
  font-weight: bold;
  src: url("/fonts/FantasqueSansMono-Bold.woff2") format("woff2"); }

@font-face {
  font-family: 'Fantasque Sans Mono';
  font-style: italic;
  src: url("/fonts/FantasqueSansMono-Italic.woff2") format("woff2"); }

@font-face {
  font-family: 'Lazy';
  src: url("/fonts/lazy.ttf") format("truetype"); }

@font-face {
  font-family: 'Material Icons';
  font-style: normal;
  font-weight: 400;
  src: url("/fonts/Material Icons.woff2") format("woff2"); }

/* fallback */
@font-face {
  font-family: 'Material Icons Outlined';
  font-style: normal;
  font-weight: 400;
  src: url("/fonts/Material Icons Outlined.woff2") format("woff2"); }

/* fallback */
@font-face {
  font-family: 'Material Icons Round';
  font-style: normal;
  font-weight: 400;
  src: url("/fonts/Material Icons Round.woff2") format("woff2"); }

/* fallback */
@font-face {
  font-family: 'Material Icons Sharp';
  font-style: normal;
  font-weight: 400;
  src: url("/fonts/Material Icons Sharp.woff2") format("woff2"); }

/* fallback */
@font-face {
  font-family: 'Material Icons Two Tone';
  font-style: normal;
  font-weight: 400;
  src: url("/fonts/Material Icons Two Tone.woff2") format("woff2"); }

.material-icons {
  font-family: 'Material Icons';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased; }

.material-icons-outlined {
  font-family: 'Material Icons Outlined';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased; }

.material-icons-round {
  font-family: 'Material Icons Round';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased; }

.material-icons-sharp {
  font-family: 'Material Icons Sharp';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased; }

.material-icons-two-tone {
  font-family: 'Material Icons Two Tone';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased; }

body,
code,
input {
  font-family: 'Fantasque Sans Mono', sans-serif;
  -webkit-font-smoothing: antialiased; }
  body article h1, body article h2, body article h3, body article h4, body article h5, body article h6, body .posts h1, body .posts h2, body .posts h3, body .posts h4, body .posts h5, body .posts h6,
  code article h1,
  code article h2,
  code article h3,
  code article h4,
  code article h5,
  code article h6,
  code .posts h1,
  code .posts h2,
  code .posts h3,
  code .posts h4,
  code .posts h5,
  code .posts h6,
  input article h1,
  input article h2,
  input article h3,
  input article h4,
  input article h5,
  input article h6,
  input .posts h1,
  input .posts h2,
  input .posts h3,
  input .posts h4,
  input .posts h5,
  input .posts h6 {
    font-weight: normal; }

strong {
  font-weight: normal;
  text-shadow: 0 0; }

* {
  margin: 0;
  padding: 0;
  user-select: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  --aside-width: 18rem;
  --box-shadow: 0 1px 6px 0 rgba(0, 0, 0, 0.1);
  --box-shadow-hover: 0 2px 16px 0 rgba(0, 0, 0, 0.1); }

* {
  --color: black;
  --border: 1px solid #dee0e2;
  --border-color: #dee0e2;
  --border-radius: 0.25rem;
  --link-color: #4588be;
  --category-color: rgba(173, 216, 230, .7);
  --background-color: white;
  --hover-color: #f7f7f7; }
  * body {
    background-color: #f6f6f6; }

::selection {
  background-color: #CCE2FF;
  color: rgba(0, 0, 0, 0.87); }

::-webkit-scrollbar {
  width: 7px;
  height: 7px; }

::-webkit-scrollbar-thumb {
  border-radius: 10px;
  background: #dddddd; }
  ::-webkit-scrollbar-thumb:hover {
    background: #acacac; }

::-webkit-scrollbar-track {
  border-radius: 10px;
  background: #f0f0f0; }

a {
  text-decoration: none;
  color: #4794d3; }

a:focus, a:hover {
  outline: none;
  text-decoration: underline; }

a.alternate:focus,
a.alternate:hover,
a.alternate:focus > *,
a.alternate:hover > * {
  text-decoration: none;
  background: var(--hover-color); }

small {
  font-size: 70%; }

ol, ul {
  margin: .5rem 0;
  padding-left: 2rem;
  word-break: break-word; }
  ol > li, ul > li {
    margin: .5rem 0; }

ul > li {
  list-style: circle; }

.result {
  width: 100%; }
  .result :first-child .post {
    margin-top: 0; }
  .result :last-child .post {
    margin-bottom: 0; }

.flex {
  display: flex; }

.flex-auto {
  flex: 1 1 auto; }

.flex-even {
  flex: 1 1; }

.flex-wrap {
  flex-wrap: wrap; }

.justify-start {
  justify-content: flex-start; }

.justify-end {
  justify-content: flex-end; }

.justify-center {
  justify-content: center; }

.justify-between {
  justify-content: space-between; }

.align-center {
  align-items: center; }

.mx-auto {
  margin: 0 auto; }

.text-center {
  text-align: center; }

.text-left {
  text-align: left; }

.text-right {
  text-align: right; }

.hidden {
  display: none; }

body {
  max-width: 80rem;
  margin: 0 auto;
  overflow: hidden scroll; }

main {
  display: flex; }

article {
  overflow: hidden;
  will-change: transform; }

div.avatar {
  text-align: center; }
  div.avatar .data-left,
  div.avatar .data-right {
    flex: 0 0 50%;
    display: inline-block;
    width: calc(50% - 1rem); }
  div.avatar .data-left {
    border-right: 1px solid var(--color); }
  div.avatar .social {
    margin-top: 1rem; }
    div.avatar .social .social-box {
      border: var(--border);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      background-color: var(--background-color);
      color: var(--color);
      margin-top: .5rem;
      padding: .5rem;
      text-align: left;
      font-size: 18px; }
      div.avatar .social .social-box:hover {
        box-shadow: var(--box-shadow-hover); }
      div.avatar .social .social-box a {
        color: var(--color); }
      div.avatar .social .social-box:hover a {
        color: var(--link-color);
        text-decoration: underline; }
      div.avatar .social .social-box img {
        vertical-align: text-bottom;
        width: 20px; }
      div.avatar .social .social-box .search {
        display: inline-block;
        width: calc(100% - 36px); }
        div.avatar .social .social-box .search > input {
          background-color: var(--background-color);
          color: var(--color);
          border: none;
          font-size: 17px;
          outline: none;
          width: 100%; }

div.categories .post-categories {
  font-size: 100%;
  margin: .5rem 0;
  line-height: 1.7rem; }

#TableOfContents > ul {
  padding-left: 0; }
  #TableOfContents > ul li {
    list-style: none; }

.flex-left,
.flex-right {
  flex: 0 0 var(--aside-width); }
  .flex-left div.outer,
  .flex-right div.outer {
    padding: .7rem;
    margin: .3rem;
    width: calc(var(--aside-width) - 2rem);
    height: calc(100% - 2rem);
    overflow: hidden;
    position: fixed; }
    .flex-left div.outer::-webkit-scrollbar-track,
    .flex-right div.outer::-webkit-scrollbar-track {
      margin: .7rem; }
    .flex-left div.outer:hover,
    .flex-right div.outer:hover {
      overflow: auto; }
  .flex-left div.inner,
  .flex-right div.inner {
    border: var(--border);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    background-color: var(--background-color);
    color: var(--color);
    box-sizing: border-box;
    width: calc(var(--aside-width) - 2rem);
    padding: .5rem;
    margin-bottom: 1rem;
    overflow: auto;
    padding: 1rem; }
    .flex-left div.inner:hover,
    .flex-right div.inner:hover {
      box-shadow: var(--box-shadow-hover); }
    .flex-left div.inner h2,
    .flex-right div.inner h2 {
      margin: .5rem 0;
      line-height: 20px; }
      .flex-left div.inner h2 > img,
      .flex-right div.inner h2 > img {
        vertical-align: -2px;
        width: 20px;
        height: 20px;
        margin-right: .5rem; }
    .flex-left div.inner ul,
    .flex-right div.inner ul {
      padding-left: 1rem; }
    .flex-left div.inner > :first-child,
    .flex-right div.inner > :first-child {
      margin-top: 0; }
    .flex-left div.inner > :last-child,
    .flex-right div.inner > :last-child {
      margin-bottom: 0; }
    .flex-left div.inner:last-of-type,
    .flex-right div.inner:last-of-type {
      margin-bottom: 0; }

.flex-left {
  margin-right: -1rem; }
  .flex-left div.outer > div.inner:nth-last-child(2) {
    margin-bottom: 0; }

.flex-right {
  margin-left: -1rem; }

.flex-hidden {
  display: none; }

.blog-page {
  flex-grow: 1;
  min-width: 18rem;
  padding: 1rem;
  width: calc(100% - 42rem); }
  .blog-page .post-toc {
    display: none; }
  .blog-page .post-pagination {
    width: 100%;
    height: 2rem; }
  .blog-page .post-content {
    border: var(--border);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    background-color: var(--background-color);
    color: var(--color); }
    .blog-page .post-content:hover {
      box-shadow: var(--box-shadow-hover); }

.pagination {
  margin: 0;
  padding: 0;
  width: 100%;
  display: flex;
  flex-flow: row nowrap;
  align-items: center;
  justify-content: center;
  font-size: 18px; }
  .pagination div.pagination-box {
    border: var(--border);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    margin: 0 .5rem;
    color: var(--link-color);
    background-color: var(--background-color);
    width: 2rem;
    height: 2rem;
    line-height: 2rem;
    float: left;
    text-align: center;
    vertical-align: middle;
    cursor: default; }
    .pagination div.pagination-box:hover {
      box-shadow: var(--box-shadow-hover); }
    .pagination div.pagination-box:not(.disabled):hover {
      background-color: var(--hover-color);
      cursor: pointer; }
  .pagination div.prev {
    width: 5rem;
    margin-left: 0; }
  .pagination div.next {
    width: 5rem;
    margin-right: 0; }
  .pagination div.pagination-eldivpsis {
    width: 3rem; }
  .pagination div.disabled {
    color: var(--color); }

.posts .post {
  border: var(--border);
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  background-color: var(--background-color);
  color: var(--color);
  margin: 1rem 0;
  padding: .7rem 1rem; }
  .posts .post:hover {
    box-shadow: var(--box-shadow-hover); }

.posts :first-child .post {
  margin-top: 0; }

.post-list {
  border: var(--border);
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow); }
  .post-list:hover {
    box-shadow: var(--box-shadow-hover); }
  .post-list .post-item {
    padding: .3rem .5rem;
    height: 1.5rem; }
    .post-list .post-item * {
      font-size: 100%;
      vertical-align: bottom; }
    .post-list .post-item:hover a {
      color: var(--link-color);
      text-decoration: underline; }

.post-link {
  color: var(--color); }
  .post-link:hover .post-title a {
    color: var(--link-color);
    text-decoration: underline; }

.post-title {
  margin: 0 0 .5rem 0;
  font-size: 20px; }
  .post-title a {
    color: var(--color); }
  .post-title:hover a {
    color: var(--link-color);
    text-decoration: underline; }

.post-meta {
  color: gray; }
  .post-meta img {
    vertical-align: text-bottom; }

.post-categories {
  font-size: 85%; }
  .post-categories a {
    background-color: var(--category-color);
    border-radius: .2rem;
    padding: .1rem .2rem; }

.post-summary {
  margin-top: .5rem; }

.post-header {
  margin-bottom: 1rem; }

.post-content {
  text-align: justify;
  background-color: white;
  padding: 1rem; }
  .post-content .md__image {
    display: block;
    max-width: 100%;
    margin: auto; }

.post-content > :first-child,
.post-content > :first-child > :first-child,
.post-content > :first-child > :first-child > :first-child,
.markdown-inner > :first-child,
.markdown-inner > :first-child > :first-child,
.markdown-inner > :first-child > :first-child > :first-child {
  margin-top: 0; }

.post-content > :last-child,
.post-content > :last-child > :last-child,
.post-content > :last-child > :last-child > :last-child,
.markdown-inner > :last-child,
.markdown-inner > :last-child > :last-child,
.markdown-inner > :last-child > :last-child > :last-child {
  margin-bottom: 0rem; }

.scroll-to-top {
  border: var(--border);
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  display: none;
  position: fixed;
  bottom: 4rem;
  right: 2rem;
  width: 2.5rem;
  height: 2.5rem;
  background-color: white; }
  .scroll-to-top:hover {
    box-shadow: var(--box-shadow-hover); }
  .scroll-to-top img {
    width: 2rem;
    height: 2rem;
    margin: .25rem; }
  .scroll-to-top:hover {
    background-color: #eeeeee; }

@media screen and (max-width: 70rem) {
  .flex-left div.outer > div.inner:nth-last-child(2) {
    margin-bottom: 1rem; }
  .flex-left .flex-hidden {
    display: block; }
  .flex-right {
    display: none; } }

@media screen and (max-width: 48rem) {
  main {
    display: block; }
  .flex-left,
  .flex-right {
    width: 100%;
    margin: 0;
    margin-bottom: -1rem; }
    .flex-left div.outer,
    .flex-right div.outer {
      position: relative;
      width: auto; }
    .flex-left div.inner,
    .flex-right div.inner {
      width: auto; }
  .blog-page {
    width: calc(100% - 2rem); } }

.book-columns {
  margin: .5rem;
  margin-left: -.5rem;
  margin-right: -.5rem; }
  .book-columns div {
    margin: .5rem; }

.book-tabs {
  margin: .5em 0;
  overflow: hidden;
  display: flex;
  flex-wrap: wrap; }
  .book-tabs label {
    display: inline-block;
    padding: .3rem 16px;
    border-top-left-radius: var(--border-radius);
    border-top-right-radius: var(--border-radius);
    cursor: pointer;
    z-index: 999;
    border: 1px solid transparent; }
  .book-tabs .book-tabs-content,
  .book-tabs .book-tabs-pure-content {
    order: 999;
    width: 100%;
    display: none;
    overflow: hidden;
    border-bottom-left-radius: var(--border-radius);
    border-bottom-right-radius: var(--border-radius); }
  .book-tabs .book-tabs-content {
    border: var(--border);
    padding: .5rem; }
  .book-tabs input[type="radio"] {
    display: none; }
    .book-tabs input[type="radio"]:not(:checked) + label {
      color: #95A5A6; }
    .book-tabs input[type="radio"]:checked + label {
      border: var(--border);
      border-bottom: none; }
      .book-tabs input[type="radio"]:checked + label + .book-tabs-content, .book-tabs input[type="radio"]:checked + label + .book-tabs-pure-content {
        display: block; }
    .book-tabs input[type="radio"]:first-of-type:checked + label + .book-tabs-pure-content :first-child {
      border-top-left-radius: 0; }

details {
  border: var(--border);
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  margin: .5rem 0;
  padding: .5rem  1rem .5rem  0.75rem; }
  details:hover {
    box-shadow: var(--box-shadow-hover); }
  details summary {
    font-size: 12.8px;
    font-weight: bold; }
    details summary::marker {
      content: '';
      font-size: 0; }
  details ::-webkit-details-marker {
    content: '';
    font-size: 0; }
  details ::-moz-list-bullet {
    content: '';
    font-size: 0; }
  details label {
    font-size: 20px !important;
    margin-left: -5px;
    margin-right: 5px;
    vertical-align: -4.5px; }
  details[open] > summary {
    margin-bottom: 0; }
    details[open] > summary label {
      transform: rotate(90deg); }
  details .markdown-inner {
    margin-top: 1em;
    padding: .5rem 0; }
  details:focus {
    outline: none; }

article h1 {
  font-size: 200%;
  line-height: 110%; }

article h2 {
  font-size: 140%;
  line-height: 120%; }

article h3 {
  font-size: 120%;
  line-height: 120%; }
  article h3 .katex {
    font-size: 100%; }

article h4 {
  font-size: 110%; }

article p {
  line-height: 1.5rem; }

article h1, article h2, article h3, article h4, article h5, article h6, article p {
  margin: .5rem 0; }
  article h1 .anchor, article h2 .anchor, article h3 .anchor, article h4 .anchor, article h5 .anchor, article h6 .anchor, article p .anchor {
    opacity: 0; }
  article h1:hover .anchor, article h1:focus .anchor, article h2:hover .anchor, article h2:focus .anchor, article h3:hover .anchor, article h3:focus .anchor, article h4:hover .anchor, article h4:focus .anchor, article h5:hover .anchor, article h5:focus .anchor, article h6:hover .anchor, article h6:focus .anchor, article p:hover .anchor, article p:focus .anchor {
    opacity: 1; }

article hr {
  border: none;
  border-bottom: 1px solid #ebeced; }

article blockquote {
  border: var(--border);
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  border-left: .3rem solid lightgray;
  padding: 0 .5rem; }
  article blockquote:hover {
    box-shadow: var(--box-shadow-hover); }

article pre {
  border: var(--border);
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  margin: .5rem 0;
  padding: .5rem 1rem;
  overflow-x: auto;
  line-height: 22px; }
  article pre:hover {
    box-shadow: var(--box-shadow-hover); }

article code {
  border: var(--border);
  border-radius: var(--border-radius);
  padding: 1px 2px; }

article pre {
  color: #686868; }
  article pre code {
    border: none;
    padding: 0; }
  article pre * {
    user-select: text;
    -moz-user-select: text;
    -webkit-user-select: text; }

article code:focus {
  outline: none; }

article .md__table {
  margin: -.5rem;
  padding: .5rem;
  overflow: auto; }
  article .md__table::-webkit-scrollbar-track {
    margin: .5rem; }
  article .md__table table {
    border: var(--border);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    border-spacing: 0;
    overflow: auto;
    -webkit-overflow-scrolling: touch; }
    article .md__table table:hover {
      box-shadow: var(--box-shadow-hover); }
    article .md__table table th {
      font-weight: normal; }
    article .md__table table td {
      border-top: 1px solid var(--border-color); }
    article .md__table table th, article .md__table table td {
      padding: .3rem 16px;
      white-space: nowrap; }

article .mermaid svg {
  display: block;
  margin: auto;
  zoom: 80%; }
</style>
  
</head>






<body>
<main>
  <div class="flex-left">
    <div class="outer">
      
  <div class="inner avatar">
  <img src="../../../../images/freeze.png" class="avatar" width="96px" height="96px" />
  <h2>NetPipe</h2>
  <div class="data-left">
    <h3>57</h3>
    <span>Posts</span>
  </div>
  <div class="data-right">
    
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
    <h3>17895</h3>
    <span>Words</span>
  </div>
  <div class="social">
    <div class="social-box">
      <img src="../../../../images/search.svg"/>
      <div class="search">
        <input type="text" placeholder="Search" id="search-key" maxlength="64" data-hotkeys="s/" onkeydown="keyup_submit(event);" />
      </div>
    </div>
    <a class="alternate" href="../../../../">
      <div class="social-box">
        <img src="../../../../images/home.svg"/>
        <object><a href="../../../../">Home</a></object>
      </div>
    </a>
    <a class="alternate" href="../../../../post/">
      <div class="social-box">
        <img src="../../../../images/posts.svg"/>
        <object><a href="../../../../post/">Posts</a></object>
      </div>
    </a>
    <a class="alternate" type="application/rss+xml" href="../../../../index.xml">
      <div class="social-box">
        <img src="../../../../images/rss.svg"/>
        <object><a  type="application/rss+xml" href="../../../../index.xml">RSS</a></object>
      </div>
    </a>
  </div>
  <script>
    function keyup_submit(e){ 
    var evt = window.event || e; 
      if (evt.keyCode == 13){
        window.location.href = '/_search?wd=' + document.getElementById("search-key").value;
      }
    }
  </script>
</div>
  <div class="inner categories">
  <h2><img src="../../../../images/categories.svg" />Categories</h2>
  
  <span class="post-categories">
    <a href="../../../../categories/math/">Math</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../../categories/acm/">ACM</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../../categories/dp/">DP</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../../categories/number-theory/">Number Theory</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../../categories/graph-theory/">Graph Theory</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../../categories/data-structure/">Data Structure</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../../categories/string/">String</a>
  </span>
  
  <span class="post-categories">
    <a href="../../../../categories/basic-algorithm/">Basic Algorithm</a>
  </span>
  
</div>

      <div class="flex-hidden">
        
  <div class="inner">
  <h2><img src="../../../../images/notice.svg" />Notice</h2>
  <p>Under Construction ...</p>
</div>
  

<div class="inner">
  <h2><img src="../../../../images/toc.svg">TOC</h2>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#简介">简介</a></li>
    <li><a href="#问题">问题</a></li>
    <li><a href="#原理">原理</a></li>
    <li><a href="#预处理">预处理</a></li>
    <li><a href="#模板">模板</a></li>
  </ul>
</nav>
</div>



      </div>
    </div>
  </div>

  
<div class="blog-page">
  <article class="post-content">
    
    <div class="post-header">
      <h1>KMP 算法</h1>
      <span class="post-meta">
        
          <img src="../../../../images/time.svg"></img>
          May 28, 2021
        
      </span>
      <span class="post-categories">
        
          <a href="../../../../categories/acm/">ACM</a>
        
          <a href="../../../../categories/string/">String</a>
        
      </span>
    </div>
    
    <h2 id="简介">简介 <a class="anchor" href="#%e7%ae%80%e4%bb%8b">¶</a></h2><p><code>KMP</code> 算法并不能用来看毛片，它是一种字符串匹配算法.<code>KMP</code> 是该算法的发明者 <code>Kruth</code>，<code>Morris</code> 和 <code>Pratt</code> 的名字缩写.</p>
<p><img class="md__image" src="1.png" alt=""  /></p>
<h2 id="问题">问题 <a class="anchor" href="#%e9%97%ae%e9%a2%98">¶</a></h2><p>给定字符串 $A$（长度为 $m$）和 $B$（长度为 $n$），问 $A$ 中是否包含 $B$ ？</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>考虑暴力算法：</p>
<ul>
<li>先将 $A$ 和 $B$ 左端对齐.</li>
<li>如果匹配失败，就将 $B$ 右移一位，直到匹配成功.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a<span style="color:#728e00">}</span> <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A=a <span style="color:#728e00">\ </span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}</span> <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B=<span style="color:#728e00">\;</span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A=a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a<span style="color:#728e00">}</span> <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B=<span style="color:#728e00">\;</span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A=a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}</span> <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B=<span style="color:#728e00">\;</span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A=a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">}</span><span style="color:#728e00">\\</span>
B=<span style="color:#728e00">\;</span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>时间复杂度：$O(mn)$.</p>
<blockquote class="book-hint warning">
<p>本章统一使用<font color=red>红色</font>表示不匹配，<font color=green>绿色</font>表示匹配.</p>
</blockquote>

<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">bool</span> <span style="color:#d35400">match</span>(<span style="color:#434f54">string</span> <span style="color:#434f54">a</span>, <span style="color:#434f54">string</span> <span style="color:#434f54">b</span>) {
    <span style="color:#00979d">int</span> <span style="color:#434f54">m</span> <span style="color:#728e00">=</span> <span style="color:#434f54">a</span>.<span style="color:#434f54">size</span>(), <span style="color:#434f54">n</span> <span style="color:#728e00">=</span> <span style="color:#434f54">b</span>.<span style="color:#434f54">size</span>();
    <span style="color:#00979d">int</span> <span style="color:#434f54">i</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
    <span style="color:#728e00">while</span>(<span style="color:#434f54">i</span> <span style="color:#728e00">&lt;</span> <span style="color:#434f54">m</span>) {
        <span style="color:#728e00">while</span>(<span style="color:#434f54">j</span> <span style="color:#728e00">&lt;</span> <span style="color:#434f54">n</span> <span style="color:#728e00">&amp;&amp;</span> <span style="color:#434f54">a</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">==</span> <span style="color:#434f54">b</span>[<span style="color:#434f54">j</span>]) <span style="color:#434f54">j</span> <span style="color:#728e00">++</span>;
        <span style="color:#728e00">if</span>(<span style="color:#434f54">j</span> <span style="color:#728e00">==</span> <span style="color:#434f54">n</span>) <span style="color:#728e00">return</span> <span style="color:#728e00">true</span>;
        <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
    }
    <span style="color:#728e00">return</span> <span style="color:#728e00">false</span>;
}
</code></pre></div><h2 id="原理">原理 <a class="anchor" href="#%e5%8e%9f%e7%90%86">¶</a></h2><p>当匹配失败时，我们忽视了一些重要的信息.当第一次匹配失败时，两个绿串相等.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}</span> <span style="color:#728e00">\ \textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a<span style="color:#728e00">}</span> <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}</span> <span style="color:#728e00">\ \textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>该绿串还有着相同的前缀<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>和后缀.我们管它叫做「公共前后缀」.$abab$ 的公共前后缀为 $ab$.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span>前缀<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}}}</span> <span style="color:#728e00">\ \underset</span><span style="color:#728e00">{</span>后缀<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}}}</span>
</code></pre></div><p>从下面这个角度看，$A$ 和 $B$ 划线的两段，都是公共前后缀，它们相等.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ \underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}}</span> <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}}</span> <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>若 $B$ 右移后能与 $A$ 匹配，那么 $B$ 至少要右移 $2$ 位，也就是使相等的两段对齐.这样就避免了一位一位地移，从而提高效率.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A=a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}}</span> <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c<span style="color:#728e00">\\</span>
B=<span style="color:#728e00">\;</span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a <span style="color:#728e00">\ </span>b<span style="color:#728e00">}}</span> <span style="color:#728e00">\ </span>a <span style="color:#728e00">\ </span>b <span style="color:#728e00">\ </span>c
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>到此为止，<code>KMP</code> 的思路已经很明朗了.</p>





<div class="book-tabs"><input type="radio" class="toggle" name="tabs-0" id="tabs-0-0" checked="checked" />
  <label for="tabs-0-0">1</label>
  <div  class="book-tabs-content" >
    <div class="markdown-inner"><p>将 $A$ 串和 $B$ 串左端对齐（$σ$ 表示不定字符）.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A <span style="color:#728e00">&amp;</span>= σσσσσσσσσσσσ<span style="color:#728e00">\\</span>
B <span style="color:#728e00">&amp;</span>= σσσσσσσ
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div>
  </div><input type="radio" class="toggle" name="tabs-0" id="tabs-0-1"  />
  <label for="tabs-0-1">2</label>
  <div  class="book-tabs-content" >
    <div class="markdown-inner"><p>从左往右比较字符，直到不匹配.此时 $A$ 和 $B$ 的绿串相等.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A <span style="color:#728e00">&amp;</span>= <span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>σσσσσ<span style="color:#728e00">}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}</span>σ<span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σσσσσσ<span style="color:#728e00">\\</span>
B <span style="color:#728e00">&amp;</span>= <span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>σσσσσ<span style="color:#728e00">}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}</span>σ<span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σ
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div>
  </div><input type="radio" class="toggle" name="tabs-0" id="tabs-0-2"  />
  <label for="tabs-0-2">3</label>
  <div  class="book-tabs-content" >
    <div class="markdown-inner"><p>在绿串中找出相同的前缀和后缀（公共前后缀）.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A <span style="color:#728e00">&amp;</span>= <span style="color:#728e00">\color</span><span style="color:#728e00">{</span>lightgreen<span style="color:#728e00">}{</span>σσσ<span style="color:#728e00">}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span>σσ<span style="color:#728e00">}}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σσσσσσσ<span style="color:#728e00">\\</span>
B <span style="color:#728e00">&amp;</span>= <span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span>σσ<span style="color:#728e00">}}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>lightgreen<span style="color:#728e00">}{</span>σσσ<span style="color:#728e00">}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σσ
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div>
  </div><input type="radio" class="toggle" name="tabs-0" id="tabs-0-3"  />
  <label for="tabs-0-3">4</label>
  <div  class="book-tabs-content" >
    <div class="markdown-inner"><p>右移 $B$ 串，直到前缀和后缀竖直对齐.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A = <span style="color:#728e00">\color</span><span style="color:#728e00">{</span>lightgreen<span style="color:#728e00">}{</span>σσσ<span style="color:#728e00">}&amp;</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span>σσ<span style="color:#728e00">}}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σσσσσσσ<span style="color:#728e00">\\</span>
B = <span style="color:#728e00">\;</span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span>σσ<span style="color:#728e00">}}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>lightgreen<span style="color:#728e00">}{</span>σσσ<span style="color:#728e00">}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σσ
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div>
  </div><input type="radio" class="toggle" name="tabs-0" id="tabs-0-4"  />
  <label for="tabs-0-4">5</label>
  <div  class="book-tabs-content" >
    <div class="markdown-inner"><p>从对齐部分的后一个字符开始，继续向右匹配，重复前面的过程.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A = σσσ<span style="color:#728e00">&amp;</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span>σσ<span style="color:#728e00">}}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>goldenrod<span style="color:#728e00">}</span>σ<span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σσσσσσ<span style="color:#728e00">\\</span>
B = <span style="color:#728e00">\;</span><span style="color:#728e00">&amp;</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span>σσ<span style="color:#728e00">}}</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>goldenrod<span style="color:#728e00">}</span>σ<span style="color:#728e00">\color</span><span style="color:#728e00">{</span>black<span style="color:#728e00">}</span>σσσσ
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div>
  </div></div>

<p>现在还有一个问题：在程序中，如何实现字符串的右移？$——$ 使用指针.</p>
<p>指针 $i,j$ 分别指向 $A$ 串和 $B$ 串，表示 $A[i]$ 和 $B[j]$ 前的两个绿串匹配.如果将 $B$ 串右移 $x$ 位，那么在程序中，只需要将 $j$ 指针左移 $x$ 位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>σσσσσ<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>σ<span style="color:#728e00">}}</span>σσσσσσ<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>σσσσσ<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>σ<span style="color:#728e00">}}</span>σ
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A=σσσ<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>σσ<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span>σ<span style="color:#728e00">}&amp;</span>σσσσσσ<span style="color:#728e00">\\</span>
B=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>σσ<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span>σ<span style="color:#728e00">}&amp;</span>σσσσ
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>$pre[i]$ 表示 $B[0\cdots i]$ 的公共前后缀长度，$pre[ \ ]$ 具体怎么预处理后续会说.现在假设 $pre[ \ ]$ 数组已经处理好了.依照刚才的思路，<code>KMP</code> 的主程序可以分解为以下步骤（结合下面的样例理解）：</p>
<ol>
<li>
<p>令 $i,j$ 分别指向 $A$ 和 $B$ 的开头，即 $i=0,j=0$.</p>
</li>
<li>
<p>如果 $A[i]=B[j]$，$i$ 和 $j$ 同时右移一位.</p>
</li>
<li>
<p>如果 $A[i]≠B[j]$，又分两种情况讨论：</p>
<ul>
<li>
<p>$j≠0$ 时，绿串的公共前后缀长度为 $pre[j-1]$.那么就令 $j=pre[j-1]$.</p>
</li>
<li>
<p>$j=0$ 时，$j$ 不能再往左移.此时只能将 $i$ 右移一位.</p>
</li>
</ul>
</li>
<li>
<p>重复 2、3 两个步骤，直到匹配完成.</p>
</li>
</ol>





<div class="book-tabs"><input type="radio" class="toggle" name="tabs-1" id="tabs-1-0" checked="checked" />
  <label for="tabs-1-0">1</label>
  <div  class="book-tabs-content" >
    <div class="markdown-inner"><p>令指针 $i$ 和 $j$ 分别指向 $A$ 串和 $B$ 串的开头.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span>a<span style="color:#728e00">}</span>bababc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span>a<span style="color:#728e00">}</span>babc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div>
  </div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-1"  />
  <label for="tabs-1-1">2</label>
  <div  class="book-tabs-content" >
    <div class="markdown-inner"><p>$A[i]=B[i]$，$i$ 和 $j$ 同时右移一位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a<span style="color:#728e00">}}</span>bababc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a<span style="color:#728e00">}}</span>babc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div>
  </div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-2"  />
  <label for="tabs-1-2">3</label>
  <div  class="book-tabs-content" >
    <div class="markdown-inner"><p>$A[i]=B[j]$，$i$ 和 $j$ 同时右移一位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span>a<span style="color:#728e00">}</span>babc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span>a<span style="color:#728e00">}</span>bc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div>
  </div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-3"  />
  <label for="tabs-1-3">4</label>
  <div  class="book-tabs-content" >
    <div class="markdown-inner"><p>$A[i]=B[j]$，$i$ 和 $j$ 同时右移一位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a<span style="color:#728e00">}}</span>babc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a<span style="color:#728e00">}}</span>bc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div>
  </div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-4"  />
  <label for="tabs-1-4">5</label>
  <div  class="book-tabs-content" >
    <div class="markdown-inner"><p>$A[i]=B[j]$，$i$ 和 $j$ 同时右移一位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span>a<span style="color:#728e00">}</span>bc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div>
  </div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-5"  />
  <label for="tabs-1-5">6</label>
  <div  class="book-tabs-content" >
    <div class="markdown-inner"><p>$A[i]≠B[j]$，令 $j=pre[j-1]=2$.这样，$A[i]$ 和 $B[j]$ 前的绿串就又匹配了.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>lightgreen<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>a<span style="color:#728e00">}}</span>bc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}}</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>lightgreen<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>red<span style="color:#728e00">}{</span>c<span style="color:#728e00">}}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=ab<span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span>a<span style="color:#728e00">}</span>bc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span>a<span style="color:#728e00">}</span>bc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><blockquote class="book-hint warning">
<p>字符串的下标是从 $0$ 开始计算的.$j=2$ 实际上就是将 $j$ 指向 $B$ 串的第 $3$ 个字符.</p>
</blockquote>
</div>
  </div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-6"  />
  <label for="tabs-1-6">7</label>
  <div  class="book-tabs-content" >
    <div class="markdown-inner"><p>$A[i]=B[j]$，$i$ 和 $j$ 同时右移一位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=ab<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a<span style="color:#728e00">}}</span>bc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>a<span style="color:#728e00">}}</span>bc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div>
  </div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-7"  />
  <label for="tabs-1-7">8</label>
  <div  class="book-tabs-content" >
    <div class="markdown-inner"><p>$A[i]=B[j]$，$i$ 和 $j$ 同时右移一位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=ab<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span>c<span style="color:#728e00">}</span><span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}</span>c<span style="color:#728e00">}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div>
  </div><input type="radio" class="toggle" name="tabs-1" id="tabs-1-8"  />
  <label for="tabs-1-8">9</label>
  <div  class="book-tabs-content" >
    <div class="markdown-inner"><p>$A[i]=B[j]$，$i$ 和 $j$ 同时右移一位.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=ab<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>abab<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>c<span style="color:#728e00">}}</span><span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>abab<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>c<span style="color:#728e00">}}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>此时 $j=B\;$串长度 $ =5$，指到了 $B$ 串外面，代表匹配成功.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
A<span style="color:#728e00">&amp;</span>=ab<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ababc<span style="color:#728e00">}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>white<span style="color:#728e00">}{</span>b<span style="color:#728e00">}}</span><span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ababc<span style="color:#728e00">}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span><span style="color:#728e00">\color</span><span style="color:#728e00">{</span>white<span style="color:#728e00">}{</span>b<span style="color:#728e00">}}</span>
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div></div>
  </div></div>

<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">int</span> <span style="color:#434f54">pre</span>[];

<span style="color:#00979d">bool</span> <span style="color:#d35400">kmp</span>(<span style="color:#434f54">string</span> <span style="color:#434f54">A</span>, <span style="color:#434f54">string</span> <span style="color:#434f54">B</span>) {
	<span style="color:#00979d">int</span> <span style="color:#434f54">i</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
	<span style="color:#728e00">while</span>(<span style="color:#434f54">i</span> <span style="color:#728e00">&lt;</span> <span style="color:#434f54">A</span>.<span style="color:#434f54">size</span>()) {
		<span style="color:#728e00">if</span>(<span style="color:#434f54">A</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">==</span> <span style="color:#434f54">B</span>[<span style="color:#434f54">j</span>]) <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">++</span>;
		<span style="color:#728e00">else</span> <span style="color:#728e00">if</span>(<span style="color:#434f54">j</span>) <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#434f54">pre</span>[<span style="color:#434f54">j</span> <span style="color:#728e00">-</span> <span style="color:#8a7b52">1</span>];
		<span style="color:#728e00">else</span> <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>;
		<span style="color:#728e00">if</span>(<span style="color:#434f54">j</span> <span style="color:#728e00">==</span> <span style="color:#434f54">B</span>.<span style="color:#434f54">size</span>()) <span style="color:#95a5a6">//匹配成功
</span><span style="color:#95a5a6"></span>            <span style="color:#728e00">return</span> <span style="color:#728e00">true</span>;
	}
    <span style="color:#728e00">return</span> <span style="color:#728e00">false</span>;
}
</code></pre></div><h2 id="预处理">预处理 <a class="anchor" href="#%e9%a2%84%e5%a4%84%e7%90%86">¶</a></h2><p>$pre[ \ ]$ 数组的求法和 <code>KMP</code> 的主程序很相似.</p>
<p>指针 $i,j$ 都指向 $B$ 串，表示当前求的是 $B[0\cdots i]$ 的公共前后缀长度 $pre[i]$.并且 $B[0\cdots i]$ 的公共前后缀为 $B[0\cdots j]$，即 $pre[i]=j+1$.</p>
<p>因为 $pre[0]=0$ 不用求，所以直接从 $pre[1]$ 开始求就好，初始时 $i=1,j=0$.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span>aba<span style="color:#728e00">}</span>bc<span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span>a<span style="color:#728e00">}</span>babc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>然后，我们直接采用 <a href="../../../../docs/NOI/String/KMP/#%E5%8E%9F%E7%90%86"><code>KMP</code> 主程序</a> 的策略：</p>
<ol>
<li>
<p>如果 $B[i]=B[j]$，那么 $pre[i]=j+1$，并将 $i$ 和 $j$ 同时右移一位.</p>
</li>
<li>
<p>如果 $B[i]≠B[j]$，又分两种情况讨论：</p>
<ul>
<li>
<p>$j≠0$ 时，绿串的公共前后缀长度为 $pre[j-1]$.那么就令 $j=pre[j-1]$.</p>
</li>
<li>
<p>$j=0$ 时，绿串长度为 $0$，$j$ 不能再往左移了.此时只能将 $i$ 右移一位.</p>
</li>
</ul>
</li>
<li>
<p>重复前两步，直到 $pre[ \ ]$ 全部求完.</p>
</li>
</ol>
<p>为什么可以这么做呢？因为仅当 $B[i]$ 和 $B[j]$ 前的若干个字符相匹配时，$B[0\cdots j]$ 才可能是公共前后缀.而 <code>KMP</code> 的主程序能够维护这一特征.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-latex" data-lang="latex"><span style="color:#728e00">\begin</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
B<span style="color:#728e00">&amp;</span>=ab<span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}}</span><span style="color:#728e00">\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\overset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> i<span style="color:#728e00">}{</span>↓<span style="color:#728e00">}}{</span>c<span style="color:#728e00">}</span><span style="color:#728e00">\\</span>
B<span style="color:#728e00">&amp;</span>=<span style="color:#728e00">\underline</span><span style="color:#728e00">{</span><span style="color:#728e00">\textcolor</span><span style="color:#728e00">{</span>green<span style="color:#728e00">}{</span>ab<span style="color:#728e00">}}</span><span style="color:#728e00">\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su\underset</span><span style="color:#728e00">{</span><span style="color:#728e00">\su</span> j<span style="color:#728e00">}{</span>↑<span style="color:#728e00">}}{</span>a<span style="color:#728e00">}</span>bc
<span style="color:#728e00">\end</span><span style="color:#728e00">{</span>aligned<span style="color:#728e00">}</span>
</code></pre></div><p>也就是说，预处理 $pre[ \ ]$ 数组，和 <code>KMP</code> 的主程序，其实是在干同一件事情.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00979d">int</span> <span style="color:#434f54">pre</span>[];

<span style="color:#00979d">void</span> <span style="color:#d35400">getPre</span>(<span style="color:#434f54">string</span> <span style="color:#434f54">B</span>) {
	<span style="color:#00979d">int</span> <span style="color:#434f54">i</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>; <span style="color:#95a5a6">// 注意 i = 1
</span><span style="color:#95a5a6"></span>	<span style="color:#728e00">while</span>(<span style="color:#434f54">i</span> <span style="color:#728e00">&lt;</span> <span style="color:#434f54">B</span>.<span style="color:#434f54">size</span>()) {
		<span style="color:#728e00">if</span>(<span style="color:#434f54">B</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">==</span> <span style="color:#434f54">B</span>[<span style="color:#434f54">j</span>]) <span style="color:#434f54">pre</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">=</span> <span style="color:#434f54">j</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">++</span>;
		<span style="color:#728e00">else</span> <span style="color:#728e00">if</span>(<span style="color:#434f54">j</span>) <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#434f54">pre</span>[<span style="color:#434f54">j</span> <span style="color:#728e00">-</span> <span style="color:#8a7b52">1</span>];
		<span style="color:#728e00">else</span> <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>;
	}
}
</code></pre></div><h2 id="模板">模板 <a class="anchor" href="#%e6%a8%a1%e6%9d%bf">¶</a></h2><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#728e00">const</span> <span style="color:#00979d">int</span> <span style="color:#434f54">N</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">1e6</span>;
<span style="color:#00979d">int</span> <span style="color:#434f54">pre</span>[<span style="color:#434f54">N</span>];

<span style="color:#00979d">void</span> <span style="color:#d35400">getPre</span>(<span style="color:#434f54">string</span> <span style="color:#434f54">str</span>) {
	<span style="color:#00979d">int</span> <span style="color:#434f54">i</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
	<span style="color:#728e00">while</span>(<span style="color:#434f54">i</span> <span style="color:#728e00">&lt;</span> <span style="color:#434f54">str</span>.<span style="color:#434f54">size</span>()) {
		<span style="color:#728e00">if</span>(<span style="color:#434f54">str</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">==</span> <span style="color:#434f54">str</span>[<span style="color:#434f54">j</span>]) <span style="color:#434f54">pre</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">=</span> <span style="color:#434f54">j</span> <span style="color:#728e00">+</span> <span style="color:#8a7b52">1</span>, <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">++</span>;
		<span style="color:#728e00">else</span> <span style="color:#728e00">if</span>(<span style="color:#434f54">j</span>) <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#434f54">pre</span>[<span style="color:#434f54">j</span> <span style="color:#728e00">-</span> <span style="color:#8a7b52">1</span>];
		<span style="color:#728e00">else</span> <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>;
	}
}

<span style="color:#00979d">bool</span> <span style="color:#d35400">kmp</span>(<span style="color:#434f54">string</span> <span style="color:#434f54">str</span>, <span style="color:#434f54">string</span> <span style="color:#434f54">substr</span>) {
	<span style="color:#434f54">getPre</span>(<span style="color:#434f54">substr</span>);
	<span style="color:#00979d">int</span> <span style="color:#434f54">i</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">0</span>;
	<span style="color:#728e00">while</span>(<span style="color:#434f54">i</span> <span style="color:#728e00">&lt;</span> <span style="color:#434f54">str</span>.<span style="color:#434f54">size</span>()) {
		<span style="color:#728e00">if</span>(<span style="color:#434f54">str</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">==</span> <span style="color:#434f54">substr</span>[<span style="color:#434f54">j</span>]) <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>, <span style="color:#434f54">j</span> <span style="color:#728e00">++</span>;
		<span style="color:#728e00">else</span> <span style="color:#728e00">if</span>(<span style="color:#434f54">j</span>) <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#434f54">pre</span>[<span style="color:#434f54">j</span> <span style="color:#728e00">-</span> <span style="color:#8a7b52">1</span>];
		<span style="color:#728e00">else</span> <span style="color:#434f54">i</span> <span style="color:#728e00">++</span>;
		<span style="color:#728e00">if</span>(<span style="color:#434f54">j</span> <span style="color:#728e00">==</span> <span style="color:#434f54">substr</span>.<span style="color:#434f54">size</span>())
            <span style="color:#728e00">return</span> <span style="color:#728e00">true</span>;
	}
    <span style="color:#728e00">return</span> <span style="color:#728e00">false</span>;
}

<span style="color:#00979d">int</span> <span style="color:#d35400">main</span>() {
	<span style="color:#434f54">string</span> <span style="color:#434f54">str</span>, <span style="color:#434f54">substr</span>;
	<span style="color:#434f54">cin</span> <span style="color:#728e00">&gt;&gt;</span> <span style="color:#434f54">str</span> <span style="color:#728e00">&gt;&gt;</span> <span style="color:#434f54">substr</span>;
	<span style="color:#434f54">cout</span> <span style="color:#728e00">&lt;&lt;</span> <span style="color:#434f54">kmp</span>(<span style="color:#434f54">str</span>, <span style="color:#434f54">substr</span>);
	<span style="color:#728e00">return</span> <span style="color:#8a7b52">0</span>;
} 
</code></pre></div><section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>字符串 $s$ 左部的任意子串为 $s$ 的前缀，且 $s$ 的前缀不能是 $s$ 本身.例如 <code>freeze</code> 的前缀有 <code>f</code>，<code>fr</code>，<code>fre</code>，<code>free</code>，<code>freez</code>.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

  </article>
  <div class="scroll-to-top">
    <img src="../../../../images/scroll-to-top.svg">
  </div>
</div>



  <div class="flex-right">
    <div class="outer">
      
  <div class="inner">
  <h2><img src="../../../../images/notice.svg" />Notice</h2>
  <p>Under Construction ...</p>
</div>
  

<div class="inner">
  <h2><img src="../../../../images/toc.svg">TOC</h2>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#简介">简介</a></li>
    <li><a href="#问题">问题</a></li>
    <li><a href="#原理">原理</a></li>
    <li><a href="#预处理">预处理</a></li>
    <li><a href="#模板">模板</a></li>
  </ul>
</nav>
</div>



    </div>
  </div>

  <script src="../../../../js/jquery.min.js"></script>


<script defer>















































</script>



<script>
function judgeScroll() {
  var scrollTop = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop;
  var scrollToTop = document.getElementsByClassName("scroll-to-top")[0];
  if (scrollTop <= 50) {
    scrollToTop.style.display = 'none';
  } else {
    scrollToTop.style.display = 'block';
  }
}
window.addEventListener("scroll", function(event) {
  judgeScroll();
});
$(".scroll-to-top").click(function() {
  $(window).scrollTop(true);
});
judgeScroll();
</script>





<link rel="stylesheet" href="../../../../katex/katex.min.css">
<script src="../../../../katex/katex.min.js"></script>
<script src="../../../../katex/auto-render.min.js"></script>

<script>
  function renderTex() {
    renderMathInElement(document.body, {
      trust: true,
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false }
      ],
      macros: {
        
        "\\d": "\\text{d}",
        "\\zh": "\\footnotesize \\ ",
        "\\en": "\\normalsize \\ ",
        "\\su": "\\displaystyle",
        "\\eq": "\\Longleftrightarrow",
        "\\intro": "\\Longrightarrow",
        "\\mathring": "\\overset\{\\normalsizeₒ\}",
        "\\arccot": "\\text\{arccot\} \\, ",
        "\\xor": "\\text\{xor\} \\, ",
        "\\mex": "\\text\{mex\} \\, "
      }
    });
  }  
  document.addEventListener("DOMContentLoaded", function() {
    renderTex();
  });

</script>

<script>
    Array.from(document.getElementsByClassName("language-latex")).forEach(
      (el) => {
        
        el.parentElement.outerHTML = `<div>$$${el.innerText}$$</div>`;
      }
    );
</script>

<script>
  Array.from(document.getElementsByTagName("table")).forEach(
    (el) => {
      el.outerHTML = `<div class="md__table">${el.outerHTML}</div>`;
    }
  );
</script>



<script src="../../../../js/mermaid.min.js"></script>

<script>
  mermaid.initialize({
    
    themeCSS: ".node rect { \
      fill: transparent;    \
      stroke: transparent;  \
    }                       \
    .nodeLabel {            \
      font-size: 24px;      \
    }",
    startOnLoad: true,
    flowchart: {
      curve: 'cardinal'
    },
    securityLevel: 'loose',
  });
</script>

<script>
  Array.from(document.getElementsByClassName("language-mermaid")).forEach(
    (el) => {
      el.parentElement.outerHTML = `<div class="mermaid">${el.innerText}</div>`;
    }
  );
</script>

  
</main>
</body>
</html>